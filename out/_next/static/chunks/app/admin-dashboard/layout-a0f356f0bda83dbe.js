(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[908],{26857:(e,s,t)=>{Promise.resolve().then(t.bind(t,64197))},64197:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>N});var l=t(6012),n=t(18192),a=t(14274),o=t(3932),r=t(52544),i=t(63230),c=t(63169),d=t(78703),u=t(91346),h=t(8168),m=t(14546),x=t(97722),f=t(50694),g=t(49550),p=t(17035),j=t(30487);function v(e){let{adminUser:s,onLogout:t}=e,n=async()=>{confirm("Are you sure you want to logout?")&&t()};return(0,l.jsx)("header",{className:"sticky top-0 z-50 border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60",children:(0,l.jsxs)("div",{className:"flex h-16 items-center px-4",children:[(0,l.jsx)("div",{className:"flex items-center gap-2",children:(0,l.jsx)(o.x2,{})}),(0,l.jsx)("div",{className:"flex-1 flex items-center justify-center px-4",children:(0,l.jsxs)("div",{className:"w-full max-w-md relative",children:[(0,l.jsx)(d.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),(0,l.jsx)(g.p,{placeholder:"Search stores, users, packages...",className:"pl-10 w-full"})]})}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsxs)(f.$,{variant:"ghost",size:"icon",className:"relative",children:[(0,l.jsx)(u.A,{className:"h-5 w-5"}),(0,l.jsx)(j.E,{variant:"destructive",className:"absolute -top-1 -right-1 h-5 w-5 rounded-full p-0 flex items-center justify-center text-xs",children:"0"})]}),(0,l.jsxs)(p.rI,{children:[(0,l.jsx)(p.ty,{asChild:!0,children:(0,l.jsx)(f.$,{variant:"ghost",size:"icon",children:(0,l.jsx)(h.A,{className:"h-5 w-5"})})}),(0,l.jsxs)(p.SQ,{align:"end",className:"w-56",children:[(0,l.jsx)(p.lp,{children:"Admin Account"}),(0,l.jsx)(p.mB,{}),(0,l.jsxs)("div",{className:"px-2 py-1.5 text-sm text-muted-foreground",children:[(0,l.jsx)("div",{className:"font-medium",children:(null==s?void 0:s.email)||"Unknown User"}),(0,l.jsx)("div",{className:"text-xs",children:(null==s?void 0:s.role)||"ADMIN"})]}),(0,l.jsx)(p.mB,{}),(0,l.jsxs)(p._2,{children:[(0,l.jsx)(m.A,{className:"mr-2 h-4 w-4"}),(0,l.jsx)("span",{children:"Settings"})]}),(0,l.jsx)(p.mB,{}),(0,l.jsxs)(p._2,{className:"text-red-600",onClick:n,children:[(0,l.jsx)(x.A,{className:"mr-2 h-4 w-4"}),(0,l.jsx)("span",{children:"Log out"})]})]})]})]})]})})}function N(e){let{children:s}=e,t=(0,a.useRouter)(),d=(0,a.usePathname)(),{toast:u}=(0,i.dj)(),[h,m]=(0,n.useState)(!1),[x,f]=(0,n.useState)(!0),[g,p]=(0,n.useState)(null);(0,n.useEffect)(()=>{let e=setTimeout(async()=>{if("/admin-login"===d||h){f(!1);return}try{console.log("Checking authentication...");let e="http://localhost:3001";console.log("API Base URL:",e);let s=await fetch("".concat(e,"/auth/admin-login/verify"),{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}});if(console.log("Auth check response status:",s.status),console.log("Auth check response headers:",Object.fromEntries(s.headers.entries())),!s.ok)throw Error("Invalid token - Status: ".concat(s.status));let t=await s.json();if(console.log("Auth check response body:",t),t.success)p({email:t.user.email,role:t.user.role}),m(!0),console.log("Authentication successful");else throw Error("Invalid token")}catch(e){console.error("Auth validation error:",e),"undefined"!=typeof document&&(document.cookie="admin-token=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/",localStorage.removeItem("admin-token")),"/admin-login"!==d&&(console.log("Redirecting to login page"),t.push("/admin-login"))}finally{f(!1)}},100);return()=>clearTimeout(e)},[t,u,d,h]);let j=async()=>{try{if((await fetch("".concat("http://localhost:3001","/auth/admin-login/logout"),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}})).ok)"undefined"!=typeof localStorage&&localStorage.removeItem("admin-token"),t.push("/admin-login"),u({title:"Logged Out",description:"You have been successfully logged out."});else throw Error("Logout failed")}catch(e){console.error("Logout error:",e),"undefined"!=typeof document&&(document.cookie="admin-token=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/",localStorage.removeItem("admin-token")),t.push("/admin-login"),u({title:"Logged Out",description:"You have been logged out."})}};return x?(0,l.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto"}),(0,l.jsx)("p",{className:"mt-2 text-gray-600",children:"Loading..."})]})}):h?(0,l.jsxs)(o.GB,{children:[(0,l.jsx)("div",{className:"flex h-screen w-full flex-col",children:(0,l.jsxs)("div",{className:"flex flex-1 overflow-hidden",children:[(0,l.jsx)(c.G,{isAdmin:!0,adminUser:g}),(0,l.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,l.jsx)(v,{adminUser:g,onLogout:j}),(0,l.jsx)("main",{className:"flex-1 overflow-auto p-6 bg-muted/10",children:s})]})]})}),(0,l.jsx)(r.l,{})]}):null}}},e=>{var s=s=>e(e.s=s);e.O(0,[863,372,334,118,573,879,274,746,847,358],()=>s(26857)),_N_E=e.O()}]);