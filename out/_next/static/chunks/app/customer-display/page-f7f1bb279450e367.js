(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[472],{14459:(e,t,a)=>{"use strict";a.d(t,{w:()=>l});var s=a(6012),r=a(18192),n=a(64421),c=a(22293);let l=r.forwardRef((e,t)=>{let{className:a,orientation:r="horizontal",decorative:l=!0,...o}=e;return(0,s.jsx)(n.b,{ref:t,decorative:l,orientation:r,className:(0,c.cn)("shrink-0 bg-border","horizontal"===r?"h-[1px] w-full":"h-full w-[1px]",a),...o})});l.displayName=n.b.displayName},22293:(e,t,a)=>{"use strict";a.d(t,{cn:()=>n});var s=a(64812),r=a(13673);function n(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,r.QP)((0,s.$)(t))}},30487:(e,t,a)=>{"use strict";a.d(t,{E:()=>l});var s=a(6012);a(18192);var r=a(53262),n=a(22293);let c=(0,r.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground",success:"border-transparent bg-green-500 text-white hover:bg-green-600",warning:"border-transparent bg-yellow-500 text-white hover:bg-yellow-600"}},defaultVariants:{variant:"default"}});function l(e){let{className:t,variant:a,...r}=e;return(0,s.jsx)("div",{className:(0,n.cn)(c({variant:a}),t),...r})}},31564:(e,t,a)=>{"use strict";a.d(t,{BT:()=>d,Wu:()=>i,ZB:()=>o,Zp:()=>c,aR:()=>l});var s=a(6012),r=a(18192),n=a(22293);let c=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...r})});c.displayName="Card";let l=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",a),...r})});l.displayName="CardHeader";let o=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",a),...r})});o.displayName="CardTitle";let d=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",a),...r})});d.displayName="CardDescription";let i=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",a),...r})});i.displayName="CardContent",r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",a),...r})}).displayName="CardFooter"},32839:(e,t,a)=>{"use strict";a.d(t,{h:()=>n});var s=a(18192),r=a(12690);function n(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{storeId:t,onMessage:a,onOpen:n,onError:c,onClose:l}=e,[o,d]=(0,s.useState)(!1),[i,u]=(0,s.useState)(null),p=(0,s.useRef)(null),m=()=>{var e;if(null===(e=p.current)||void 0===e?void 0:e.connected)return;if(!t){u("Store ID is required to connect");return}p.current=(0,r.io)("http://localhost:3001",{path:"/websocket",auth:{storeId:t}});let s=p.current;s.on("connect",()=>{d(!0),u(null),null==n||n()}),s.on("connection_established",e=>{console.log("WebSocket connection established:",e)}),s.on("stock_update",e=>{null==a||a({type:"stock_update",data:e,timestamp:new Date})}),s.on("order_status",e=>{null==a||a({type:"order_status",data:e,timestamp:new Date})}),s.on("payment_received",e=>{null==a||a({type:"payment_received",data:e,timestamp:new Date})}),s.on("low_stock_alert",e=>{null==a||a({type:"low_stock_alert",data:e,timestamp:new Date})}),s.on("new_order",e=>{null==a||a({type:"new_order",data:e,timestamp:new Date})}),s.on("error",e=>{u(e.message),null==c||c(e)}),s.on("disconnect",e=>{d(!1),null==l||l(),console.log("WebSocket disconnected:",e)})},x=()=>{p.current&&(p.current.disconnect(),p.current=null,d(!1))};return(0,s.useEffect)(()=>(m(),()=>{x()}),[t]),{isConnected:o,error:i,sendMessage:e=>{var t;(null===(t=p.current)||void 0===t?void 0:t.connected)?p.current.emit(e.type,e.data):console.warn("WebSocket not connected. Cannot send message.")},disconnect:x,reconnect:m}}},33823:(e,t,a)=>{Promise.resolve().then(a.bind(a,73179))},39368:(e,t,a)=>{"use strict";a.d(t,{LP:()=>d,ZN:()=>c,ZQ:()=>n,cN:()=>l,ic:()=>i,pO:()=>o});let s="http://localhost:3001";async function r(e){let t=await e.json();if(!e.ok)throw Error(t.error||"API request failed");return t}let n={login:async(e,t)=>r(await fetch("".concat(s,"/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:e,password:t})})),logout:async()=>r(await fetch("".concat(s,"/auth/logout"),{method:"POST",credentials:"include"})),getMe:async()=>r(await fetch("".concat(s,"/auth/me"),{credentials:"include"}))},c={getAll:async()=>r(await fetch("".concat(s,"/products"),{credentials:"include"})),getById:async e=>r(await fetch("".concat(s,"/products/").concat(e),{credentials:"include"})),create:async e=>r(await fetch("".concat(s,"/products"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)})),update:async(e,t)=>r(await fetch("".concat(s,"/products/").concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t)})),delete:async e=>r(await fetch("".concat(s,"/products/").concat(e),{method:"DELETE",credentials:"include"}))},l={getAll:async e=>{let t=new URL("".concat(s,"/orders"));return e&&t.searchParams.append("storeId",e),r(await fetch(t.toString(),{credentials:"include"}))},getById:async e=>r(await fetch("".concat(s,"/orders/").concat(e),{credentials:"include"})),create:async e=>r(await fetch("".concat(s,"/orders"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)}))},o={getStock:async()=>r(await fetch("".concat(s,"/inventory/stock"),{credentials:"include"})),getAlerts:async()=>r(await fetch("".concat(s,"/inventory/alerts"),{credentials:"include"})),updateStock:async(e,t)=>r(await fetch("".concat(s,"/inventory/stock/").concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({stock:t})}))},d={getDashboardData:async e=>{let t=new URL("".concat(s,"/analytics/dashboard"));return e&&t.searchParams.append("storeId",e),r(await fetch(t.toString(),{credentials:"include"}))}},i={createStore:async e=>r(await fetch("".concat(s,"/admin/create-store"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)})),getDashboardData:async()=>r(await fetch("".concat(s,"/admin/analytics/dashboard"),{credentials:"include"})),getUsers:async()=>r(await fetch("".concat(s,"/admin/users"),{credentials:"include"})),getStores:async()=>r(await fetch("".concat(s,"/admin/create-store"),{credentials:"include"})),getSubscriptionPackages:async()=>r(await fetch("".concat(s,"/admin/subscription-packages"),{credentials:"include"}))}},44908:(e,t,a)=>{"use strict";a.d(t,{A:()=>u,AuthProvider:()=>i});var s=a(6012),r=a(18192),n=a(14274),c=a(39368);let l={user:null,store:null,isLoading:!0,isAuthenticated:!1};function o(e,t){switch(t.type){case"SET_LOADING":return{...e,isLoading:t.payload};case"SET_AUTH_DATA":return{...e,user:t.payload.user,store:t.payload.store,isLoading:!1,isAuthenticated:!0};case"CLEAR_AUTH":return{...e,user:null,store:null,isLoading:!1,isAuthenticated:!1};case"SET_ERROR":return{...e,isLoading:!1,error:t.payload};default:return e}}let d=(0,r.createContext)(void 0);function i(e){let{children:t}=e,[a,i]=(0,r.useReducer)(o,l),u=(0,n.usePathname)();(0,r.useEffect)(()=>{if(["/login","/admin-login","/admin-dashboard"].includes(u)||u.startsWith("/admin-dashboard")){i({type:"SET_LOADING",payload:!1});return}p()},[u]);let p=async()=>{try{let e=await c.ZQ.getMe();if(e.success&&e.data){let t=e.data,a=null;if(t.storeId)try{let e=await fetch("".concat("http://localhost:3001","/store"),{credentials:"include"});if(e.ok){let t=await e.json();t.success&&t.data&&(a=t.data)}}catch(e){console.error("Failed to fetch store data:",e)}i({type:"SET_AUTH_DATA",payload:{user:{id:t.id,email:t.email,role:t.role,storeId:t.storeId},store:a}})}else i({type:"CLEAR_AUTH"})}catch(e){console.error("Auth check failed:",e),i({type:"CLEAR_AUTH"})}},m=async(e,t)=>{try{i({type:"SET_LOADING",payload:!0});let a=await c.ZQ.login(e,t);if(a.success)return i({type:"SET_AUTH_DATA",payload:{user:{id:a.data.user.id,email:a.data.user.email,role:a.data.user.role,storeId:a.data.user.storeId},store:a.data.store}}),{success:!0};return{success:!1,error:a.error}}catch(t){console.error("Login failed:",t);let e=t.message||"Login failed";return i({type:"SET_ERROR",payload:e}),{success:!1,error:e}}finally{i({type:"SET_LOADING",payload:!1})}},x=async()=>{try{await c.ZQ.logout(),i({type:"CLEAR_AUTH"}),window.location.href="/login"}catch(e){console.error("Logout failed:",e),i({type:"CLEAR_AUTH"}),window.location.href="/login"}};return(0,s.jsx)(d.Provider,{value:{state:a,dispatch:i,login:m,logout:x},children:t})}function u(){let e=(0,r.useContext)(d);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},73179:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>g});var s=a(6012),r=a(18192),n=a(32839),c=a(82426),l=a(27436),o=a(3386),d=a(89878),i=a(3399),u=a(67181),p=a(1693),m=a(77819),x=a(31564),f=a(14459),h=a(30487),y=a(96731);function g(){let{state:e}=(0,y.n)(),{store:t}=e,[a,g]=(0,r.useState)(null),[b,w]=(0,r.useState)("disconnected"),[j,N]=(0,r.useState)(new Date),v=(0,r.useCallback)(e=>{try{switch(console.log("Customer Display: Received message:",e),e.type){case"pos_cart_update":g(t=>({...e.data,status:"building",timestamp:new Date(e.timestamp)}));break;case"pos_payment_started":g(t=>t?{...t,status:"payment",timestamp:new Date(e.timestamp)}:null);break;case"pos_order_completed":g(t=>t?{...t,status:"completed",timestamp:new Date(e.timestamp)}:null),setTimeout(()=>{g(null)},5e3);break;case"pos_cart_cleared":g(null);break;default:console.warn("Unknown message type:",e.type)}}catch(e){console.error("Failed to parse WebSocket message:",e)}},[]),{isConnected:T}=(0,n.h)({onMessage:v});return(0,r.useEffect)(()=>{w(T?"connected":"disconnected")},[T]),(0,r.useEffect)(()=>{let e=setInterval(()=>{N(new Date)},1e3);return()=>clearInterval(e)},[]),(0,s.jsxs)("div",{className:"flex flex-col h-screen bg-gray-50 text-gray-800 p-6",children:[(0,s.jsx)(x.Zp,{className:"mb-6 rounded-sm shadow-md",children:(0,s.jsxs)(x.aR,{className:"flex flex-row items-center justify-between p-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(l.A,{className:"h-8 w-8 text-blue-600"}),(0,s.jsx)(x.ZB,{className:"text-2xl font-bold text-blue-800",children:(null==t?void 0:t.name)||"Store"})," "]}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1 text-sm font-medium ".concat("connected"===b?"text-green-600":"text-red-600"),children:["connected"===b?(0,s.jsx)(o.A,{className:"h-4 w-4"}):(0,s.jsx)(d.A,{className:"h-4 w-4"}),"connected"===b?"Connected":"Disconnected"]}),(0,s.jsx)("div",{className:"text-lg font-semibold",children:(0,c.GP)(j,"hh:mm:ss a")})]})]})}),a?(0,s.jsxs)("div",{className:"flex-1 grid grid-cols-2 gap-6",children:[(0,s.jsxs)(x.Zp,{className:"rounded-sm shadow-md flex flex-col",children:[(0,s.jsx)(x.aR,{className:"p-4 border-b",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)(x.ZB,{className:"text-xl font-semibold",children:"Current Order"}),(e=>{if(!e)return null;switch(e){case"building":return(0,s.jsx)(h.E,{variant:"outline",className:"bg-blue-100 text-blue-800",children:"Building Order"});case"payment":return(0,s.jsx)(h.E,{variant:"outline",className:"bg-yellow-100 text-yellow-800",children:"Payment Pending"});case"completed":return(0,s.jsx)(h.E,{variant:"outline",className:"bg-green-100 text-green-800",children:"Order Completed"});case"cleared":return(0,s.jsx)(h.E,{variant:"outline",className:"bg-gray-100 text-gray-800",children:"Cart Cleared"});default:return null}})(a.status)]})}),(0,s.jsx)(x.Wu,{className:"flex-1 p-4 overflow-y-auto",children:0===a.items.length?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-gray-500",children:[(0,s.jsx)(l.A,{className:"h-16 w-16 mb-4"}),(0,s.jsx)("p",{className:"text-lg",children:"No items in cart yet."})]}):(0,s.jsx)("ul",{className:"space-y-3",children:a.items.map((e,t)=>(0,s.jsxs)("li",{className:"flex items-center justify-between border-b pb-2 last:border-b-0",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsxs)("span",{className:"text-lg font-bold text-blue-600",children:[t+1,"."]}),e.isLoose?(0,s.jsx)(i.A,{className:"h-5 w-5 text-gray-500"}):(0,s.jsx)(u.A,{className:"h-5 w-5 text-gray-500"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-lg font-medium",children:e.productName}),(0,s.jsxs)("p",{className:"text-sm text-gray-500",children:[e.displayText," @ ",e.unitPrice.toFixed(2)," ",e.isLoose?"/".concat(e.unit):"each"]})]})]}),(0,s.jsxs)("div",{className:"text-xl font-semibold text-right",children:["PKR ",e.totalPrice.toFixed(2)]})]},e.id))})})]}),(0,s.jsx)(x.Zp,{className:"rounded-sm shadow-md flex flex-col justify-between",children:(0,s.jsxs)(x.Wu,{className:"p-6 space-y-6 flex-1 flex flex-col justify-center",children:[(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex justify-between text-2xl font-medium",children:[(0,s.jsx)("span",{children:"Subtotal:"}),(0,s.jsxs)("span",{children:["PKR ",a.subtotal.toFixed(2)]})]}),(0,s.jsxs)("div",{className:"flex justify-between text-2xl font-medium",children:[(0,s.jsxs)("span",{children:["Tax (",100*a.taxRate,"%):"]}),(0,s.jsxs)("span",{children:["PKR ",a.tax.toFixed(2)]})]}),(0,s.jsx)(f.w,{className:"my-4 bg-blue-200"}),(0,s.jsxs)("div",{className:"flex justify-between text-5xl font-bold text-blue-700",children:[(0,s.jsx)("span",{children:"Total:"}),(0,s.jsxs)("span",{children:["PKR ",a.total.toFixed(2)]})]})]}),(0,s.jsxs)("div",{className:"text-center mt-8",children:["building"===a.status&&(0,s.jsx)("p",{className:"text-3xl font-semibold text-blue-600 animate-pulse",children:"Adding Items..."}),"payment"===a.status&&(0,s.jsx)("p",{className:"text-3xl font-semibold text-yellow-600 animate-pulse",children:"Payment in Progress..."}),"completed"===a.status&&(0,s.jsxs)("div",{className:"flex flex-col items-center text-green-600",children:[(0,s.jsx)(p.A,{className:"h-20 w-20 mb-4 animate-bounce"}),(0,s.jsx)("p",{className:"text-4xl font-bold",children:"Thank You!"}),(0,s.jsx)("p",{className:"text-2xl",children:"Order Completed"})]})]})]})})]}):(0,s.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center text-gray-500",children:[(0,s.jsx)(m.A,{className:"h-24 w-24 mb-6 animate-pulse"}),(0,s.jsxs)("p",{className:"text-3xl font-semibold mb-2",children:["Welcome to ",(null==t?void 0:t.name)||"Store","!"]})," ",(0,s.jsx)("p",{className:"text-xl",children:"Your order details will appear here shortly."})]})]})}},96731:(e,t,a)=>{"use strict";a.d(t,{AppProvider:()=>d,n:()=>i});var s=a(6012),r=a(18192),n=a(44908);let c={store:null,products:[],orders:[],currentOrder:null,isLoading:!1,error:null,sidebarCollapsed:!1};function l(e,t){switch(t.type){case"SET_LOADING":return{...e,isLoading:t.payload};case"SET_ERROR":return{...e,error:t.payload};case"SET_PRODUCTS":return{...e,products:t.payload};case"ADD_PRODUCT":return{...e,products:[...e.products,t.payload]};case"UPDATE_PRODUCT":return{...e,products:e.products.map(e=>e.id===t.payload.id?t.payload:e)};case"DELETE_PRODUCT":return{...e,products:e.products.filter(e=>e.id!==t.payload)};case"SET_ORDERS":return{...e,orders:t.payload};case"ADD_ORDER":return{...e,orders:[...e.orders,t.payload]};case"UPDATE_ORDER":return{...e,orders:e.orders.map(e=>e.id===t.payload.id?t.payload:e)};case"SET_CURRENT_ORDER":return{...e,currentOrder:t.payload};case"TOGGLE_SIDEBAR":return{...e,sidebarCollapsed:!e.sidebarCollapsed};case"UPDATE_STOCK":return{...e,products:e.products.map(e=>e.id===t.payload.productId?{...e,stock:t.payload.newStock}:e)};case"UPDATE_STORE":return{...e,store:t.payload};default:return e}}let o=(0,r.createContext)(void 0);function d(e){let{children:t}=e,{state:a}=(0,n.A)(),[d,i]=(0,r.useReducer)(l,c);return(0,r.useEffect)(()=>{a.store&&i({type:"UPDATE_STORE",payload:a.store})},[a.store]),(0,s.jsx)(o.Provider,{value:{state:d,dispatch:i},children:t})}function i(){let e=(0,r.useContext)(o);if(void 0===e)throw Error("useApp must be used within an AppProvider");return e}}},e=>{var t=t=>e(e.s=t);e.O(0,[863,477,209,746,847,358],()=>t(33823)),_N_E=e.O()}]);